<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs
        title="Blog Calendar"
        title_url="http://epicmedia-gadgets.googlecode.com/svn/trunk/blog-calendar/"
        directory_title="Blog Calendar"
        description="Displays a calendar of the current month, with blog-post days as clickable links"
        screenshot="http://epicmedia-gadgets.googlecode.com/svn/trunk/blog-calendar/screenshot.png"
        thumbnail="http://epicmedia-gadgets.googlecode.com/svn/trunk/blog-calendar/thumbnail.png"
        author="Scott J. Walter"
        author_location="Minneapolis, MN"
        author_email="sjwalter+GoogleGadget@gmail.com"
        author_affiliation="EpicMedia"
        author_photo="http://epicmedia-gadgets.googlecode.com/svn/trunk/photo.png"
        author_link="http://code.google.com/p/epicmedia-gadgets/wiki/BlogCalendar"
        >
        <Require feature="dynamic-height" />
        <Require feature="setprefs" />
    </ModulePrefs>
    <UserPref name="blog_feed"	display_name="Feed URL"     required="true" />
    <Content type="html"><![CDATA[
		<style type="text/css">
        	#content__MODULE_ID__ {
        		font-family: arial, sans-serif;
                font-size: 12pt;
        		padding: 0px;
        		margin: 5px 0 0 0;
        	}

			.main {
				width:200px;
				border:1px solid black;
			}

			.month {
				background-color:black;
				font:bold 12px verdana;
				color:white;
			}

			.daysofweek {
				background-color:gray;
				font:bold 12px verdana;
				color:white;
			}

			.days {
				font-size: 12px;
				font-family:verdana;
				color:black;
				background-color: lightyellow;
				padding: 2px;
			}

			.days #today{
				font-weight: bold;
				color: red;
			}
        </style>
        <div id="content__MODULE_ID__"><p style='text-align:center;color:#cccccc;'><i>Processing...</i></p></div>
        <script type="text/javascript">
			function buildCal__MODULE_ID__(m, y, cM, cH, cDW, cD, brdr) {
				return "";

				var	mn	=	['January','February','March','April','May','June','July','August','September','October','November','December'];
				var	dim	=	[31,0,31,30,31,30,31,31,30,31,30,31];
				var	oD	=	new Date(y, m - 1, 1);

				oD.od	=   oD.getDay() + 1;

				dim[1]  =   (((oD.getFullYear()%100!=0)&&(oD.getFullYear()%4==0))||(oD.getFullYear()%400==0))?29:28;

				var t='<div class="'+cM+'"><table class="'+cM+'" cols="7" cellpadding="0" border="'+brdr+'" cellspacing="0"><tr align="center">';

				t+='<td colspan="7" align="center" class="'+cH+'">'+mn[m-1]+' - '+y+'</td></tr><tr align="center">';

				for(s=0;s<7;s++)
					t+='<td class="'+cDW+'">'+"SMTWTFS".substr(s,1)+'</td>';

				t+='</tr><tr align="center">';

				for(i=1;i<=42;i++) {
					var x=((i-oD.od>=0)&&(i-oD.od<dim[m-1]))? i-oD.od+1 : '&nbsp;';

					t+='<td class="'+cD+'">'+x+'</td>';

					if(((i)%7==0)&&(i<36))
						t+='</tr><tr align="center">';
				}

				return t+='</tr></table></div>';
			}

            var prefs__MODULE_ID__      = new _IG_Prefs(__MODULE_ID__);

            _IG_FetchXmlContent(prefs__MODULE_ID__.getString("blog_feed")
                            ,   function(feed) {
                                    if (feed == null){
                                        _gel("content__MODULE_ID__").innerHTML = "<p style='text-align:center;color:#999999;'><i>There is no data.</i></p>";
                                        return;
                                    }

									var today	=	new Date();
                                    var html    =   buildCal__MODULE_ID__(	today.getMonth() + 1
		                                        						,	today.getFullYear()
		                                        						,	"main"
		                                        						,	"month"
		                                        						,	"daysofweek"
		                                        						,	"days"
		                                        						,	1
		                                        						);

                                    var nodeset	=	feed.getElementsByTagName("item");

                                    html = "";

                                    for (var i = 0; i < nodeset.length; i++) {
                                    	html += nodeset.item(i).getElementsByTagName("pubDate").item(0).nodeValue + "<br />";
                                    }

                                    _gel("content__MODULE_ID__").innerHTML  =   html;


                                    _IG_AdjustIFrameHeight();
                                }
                            );
        </script>
    ]]></Content>
</Module>
